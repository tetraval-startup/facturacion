<?phpinclude ('../seguridad/conexion.php');/****************CODIGO INSETADO 20/02*****************///API URL/*$url = 'https://servitecperu.com/servicioweb/api/Example/FacturasSunat';//API key//Auth credentials//create a new cURL resource$ch = curl_init($url);curl_setopt($ch, CURLOPT_TIMEOUT, 30);curl_setopt($ch, CURLOPT_RETURNTRANSFER,1);curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_ANY);$result = curl_exec($ch);//close cURL resourcecurl_close($ch);*/// este es el codigo para enviar a la sunat la factura y no hacerlo desde postman lo pueden colocar donde crea que sea conveniente/**************END CODIGO INSETADO 20/02*****************/	//include"../seguridad/conexion.inc.php";	//include"../model/cComprobante.php";	//$cComprobante = new cComprobante();	$idEmpresa = 1;	//$idComprobante = 8;	$data = $_POST;	$items_detalle = json_decode($data['datadetalle'], true);	// $idComprobante = 1;$idComprobante=$data['numero_comprobante'];$detallecomprobante = '';for ($i = 0; $i < count($items_detalle); $i++) { 	$it=$i+1; 	$tolal = $items_detalle[$i]["txtIMPORTE_DET"] + $data['txt_igv_comprobante'];   	$detallecomprobante = $detallecomprobante.'d+*c|'.$idComprobante.'|'.$data['tipo_comprobante'].'|'.$it.'|'.$items_detalle[$i]["txtCODIGO_DET"].'|codpro|'.$items_detalle[$i]["txtDESCRIPCION_DET"].'|1|0|10|0|'.$items_detalle[$i]["txtUNIDAD_MEDIDA_DET"].'|'.$items_detalle[$i]["txtCANTIDAD_DET"].'|'.$items_detalle[$i]["txtPRECIO_DET"].'|0|'.$items_detalle[$i]["txtPRECIO_SIN_IGV_DET"].'|'.$items_detalle[$i]["txtIMPORTE_DET"].'|0|'.$items_detalle[$i]["txtIMPORTE_DET"].'|0.00|'.$data['txt_igv_comprobante'].'|'.$tolal.'|';		$codigo66 = $items_detalle[$i]["txtCODIGO_DET"];                    //EXTRAER DATOS					$result = mysqli_query($con,"                	SELECT l.rstock as rstock FROM productos p                    inner join lote l                      on p.id_producto=l.id_producto where l.id_producto  = $codigo66                	");                	while($row = mysqli_fetch_array($result))                	{                		$rstock = $row['rstock'] - $items_detalle[$i]['txtCANTIDAD_DET'];                	}                	                	//ACTUALIZAR CANTIDAD DE STOCK                	mysqli_query($con,"                    UPDATE `lote` SET `rstock`= $rstock                    WHERE id_producto = $codigo66;                     ");  }if ($data['tipo_comprobante'] == "01" || $data['tipo_comprobante'] == "03"){$url = 'https://servitecperu.com/servicioweb/api/Factura/comprobante';	//$url = 'http://localhost/servicioweb/api/Factura/comprobante';		//user information	$userData = array(	    'ruc' => '20604141240',	    'login' => 'SERVI001',	    'password' => 'B41e16t20o24',	    'serie' => $data['serie_comprobante'],	    'numero' => $idComprobante,	    'tipocomprobante_id' => $data['tipo_comprobante'],	    'documento' => 'c|'.$idComprobante.'|'.$data['tipo_comprobante'].'|'.$data['serie_comprobante'].'|'.$idComprobante.'|0000|10|1|'.$data['cliente_tipodocumento'].'|'.$data['cliente_numerodocumento'].'|'.$data['cliente_nombre'].'|'.$data['cliente_direccion'].'|correo@gmail.com|'.$data['fecha_comprobante'].'|'.$data['fecha_comprobante'].'|glosa|PEN|0.00|0.00|'.$data['txt_igv_comprobante'].'|0.00|0.00|0.00|'.$data['txt_total_comprobante'].'|||0.00||||0.00|0.00|0.00||0.00|'.$data['txt_total_comprobante'].'|0.00|||||'.$glosa.'|'.$detallecomprobante ,	    'tipo_respuesta' => '1'	);	//create a new cURL resource	$ch = curl_init($url);	curl_setopt($ch, CURLOPT_TIMEOUT, 30);	curl_setopt($ch, CURLOPT_RETURNTRANSFER,1);	curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_ANY);	//curl_setopt($ch, CURLOPT_HTTPHEADER, array("X-API-KEY: " . $apiKey));	//curl_setopt($ch, CURLOPT_USERPWD, "$username:$password");	curl_setopt($ch, CURLOPT_POST, 1);	curl_setopt($ch, CURLOPT_POSTFIELDS, $userData);	$result = curl_exec($ch);	echo $result;	      // return $resp;	curl_close($ch);	}  else{	$url = 'http://localhost/servicioweb/api/Factura/notacredito';$userData = array(    'ruc' => '20604141240',    'login' => 'SERVI001',    'password' => 'B41e16t20o24',    'serie' => $data['serie_comprobante'],    'numero' => $idComprobante,    'tipocomprobante_id' => $data['tipo_comprobante'],    'documento' => 'c|'.$idComprobante.'|'.$data['tipo_comprobante'].'|'.$data['serie_comprobante'].'|'.$idComprobante.'|0000|01|'.$data['notacredito_motivo_id'].'|'.$data['cliente_tipodocumento'].'|'.$data['cliente_numerodocumento'].'|'.$data['cliente_nombre'].'|'.$data['cliente_direccion'].'|correo@gmail.com|'.$data['fecha_comprobante'].'|'.$data['fecha_comprobante'].'|'.$data['notacredito_motivo_id'].'|PEN|0.00|0.00|'.$data['txt_igv_comprobante'].'|0.00|0.00|0.00|'.$data['txt_total_comprobante'].'|||0.00||||0.00|0.00|0.00||0.00|'.$data['txt_total_comprobante'].'|0.00|||||nietito|'.$detallecomprobante.'|d+*r|'.$idComprobante.'|'.$data['tipo_comprobante'].'|'.$idComprobante.'|01|'.$data['num_comprobante_modificado'].'|',    'tipo_respuesta' => '1',        'version' => '1');	//create a new cURL resource	$ch = curl_init($url);	curl_setopt($ch, CURLOPT_TIMEOUT, 30);	curl_setopt($ch, CURLOPT_RETURNTRANSFER,1);	curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_ANY);	//curl_setopt($ch, CURLOPT_HTTPHEADER, array("X-API-KEY: " . $apiKey));	//curl_setopt($ch, CURLOPT_USERPWD, "$username:$password");	curl_setopt($ch, CURLOPT_POST, 1);	curl_setopt($ch, CURLOPT_POSTFIELDS, $userData);	$result = curl_exec($ch);	echo $result;	      // return $resp;	curl_close($ch);	}/****************CODIGO INSETADO 20/02*****************///API URL$url = 'https://servitecperu.com/servicioweb/api/Example/FacturasSunat';//API key//Auth credentials//create a new cURL resource$ch = curl_init($url);curl_setopt($ch, CURLOPT_TIMEOUT, 30);curl_setopt($ch, CURLOPT_RETURNTRANSFER,1);curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_ANY);$result = curl_exec($ch);//close cURL resourcecurl_close($ch);	exit();// este es el codigo para enviar a la sunat la factura y no hacerlo desde postman lo pueden colocar donde crea que sea conveniente/**************END CODIGO INSETADO 20/02*****************/// este es el codigo para enviar a la sunat la factura y no hacerlo desde postman lo pueden colocar donde crea que sea conveniente/**************END CODIGO INSETADO 20/02*****************/// este es el codigo para enviar a la sunat la factura y no hacerlo desde postman lo pueden colocar donde crea que sea conveniente/**************END CODIGO INSETADO 20/02*****************/?>